(function(){var t={},n=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var n,r,i,a,s,e,o;t._createModelCommands=function(t,n,r){r||(r=[]);var i;if(i=t.data&&t.__id?t.data:t,this.isObject(i)||this.isArray(i)){var a;if(a=t.__id?t:{data:i,__id:this.guid()},this.isArray(i))var s=[2,a.__fork||a.__id,[],null,a.__fork||a.__id];else var s=[1,a.__fork||a.__id,{},null,a.__fork||a.__id];n&&(a.__p=n.__id),r.push(s);for(var e in i)if(i.hasOwnProperty(e)){var o=i[e];if(this.isObject(o)||this.isArray(o)){var f=this._createModelCommands(o,a,r),s=[5,e,f.__fork||f.__id,null,a.__fork||a.__id];r.push(s)}else{var s=[4,e,o,null,a.__fork||a.__id];r.push(s)}}return a}},t.addedObjects=function(){var t=[];for(var n in i)i.hasOwnProperty(n)&&(r[n]||(t.push(n),e[n]=i[n]));return t},t.commonObjects=function(){var t=[];for(var a in n)r[a]&&i[a]&&t.push(a);return t},t.compareFiles=function(t,f){r={},i={},n={},a={},s={},e={},o={},this.findObjects(t,r),this.findObjects(f,i);var u={missing:this.missingObjects(),added:this.addedObjects(),common:this.commonObjects(),cMod:[],cmds:[]},c=this;u.common.forEach(function(t){var n=c.objectDiff(r[t],i[t]);u.cMod.push(n)});var c=this;return u.added.forEach(function(t){var r=[],i=n[t];c._createModelCommands(i,null,r),r.forEach(function(t){u.cmds.push(t)})}),u.cMod.forEach(function(t){t.cmds.forEach(function(t){u.cmds.push(t)})}),u},t.findObjects=function(t,r){if(t&&t.__id&&(r[t.__fork||t.__id]=t,n[t.__fork||t.__id]=t,a[t.__id]=t),t.data){var i=t.data;for(var s in i)if(i.hasOwnProperty(s)){var e=i[s];this.isObject(e)&&(o[e.__fork||e.__id]=t.__fork||t.__id,this.findObjects(e,r))}}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.missingObjects=function(){var t=[];for(var n in r)r.hasOwnProperty(n)&&(i[n]||(s[n]=r[n],t.push(n)));return t},t.objectDiff=function(t,r){var i={modified:[],posMoved:[],sourcesAndTargets:[],cmds:[]};if(t.data&&r.data&&this.isObject(t.data)&&!this.isArray(t.data)){var a=t.data,f={};for(var u in r.data)if(r.data.hasOwnProperty(u)){var c=a[u],d=t.__fork||t.__id;if(!this.isObject(c)&&!this.isArray(c)){f[u]=!0;var h=r.data[u];r.data[u]!=c&&(this.isObject(c)||this.isObject(h)?i.cmds.push(h&&h.__id?[5,u,r.data[u].__id,null,d]:[10,u,c.__id,null,d]):(i.modified.push({id:d,prop:u,from:c,to:r.data[u]}),i.cmds.push([4,u,r.data[u],c,d])))}}for(var u in t.data)if(t.data.hasOwnProperty(u)){if(f[u])continue;var c=t.data[u],d=t.__id;if(this.isObject(c)&&!this.isArray(c)){var h=r.data[u];!h&&c&&c.__id&&i.cmds.push([10,u,c.__id,null,d])}}}if(this.isArray(t.data)){for(var _=t.data,l=r.data,p=[],v=[],b=_.length,m=l.length,O=0;b>O;O++){var M=_[O];if(this.isObject(M)){var y=M.__fork||M.__id;s[y]?i.cmds.push([8,0,y,0,o[y]]):p.push(y)}}for(var g={},j={},k={},O=0;m>O;O++){var M=l[O];if(this.isObject(M)){var y=M.__fork||M.__id;g[y]=O,j[O]=y,e[y]&&(p.push(y),i.cmds.push([7,O,y,0,o[y]])),v.push(y)}}var I=[],O=0;p.forEach(function(t){I.push(g[t]),k[t]=O,O++}),i.restackIndex=g,i.restackList=I,i.reverseIndex=j,i.restack=this.restackOps(I);var A=[],w=p.slice();i.restack.forEach(function(t){if("a"==t[0]){var r=j[t[1]],a=j[t[2]],s=(g[a],w.indexOf(r));w.splice(s,1);var e=w.indexOf(a);w.splice(e,0,r);{n[r]}i.cmds.push([12,r,e,s,o[r]])}else{var r=j[t[1]],a=j[t[2]],s=(g[a],w.indexOf(r));w.splice(s,1);var e=w.indexOf(a)+1;w.splice(e,0,r),i.cmds.push([12,r,e,s,o[r]])}}),i.stackCmds=A,i.sourceArrayWork=w,i.sourcesAndTargets.push([p,v])}return i},t.restackOps=function(t){function n(t){for(var n=t.slice(0),i=t.slice(0),a=t.slice(0).sort(function(t,n){return t-n}),s={},e={},o=0;o<i.length;o++){var f=a.indexOf(i[o]);s[i[o]]=f,e[f]=i[o],n[o]=f}var u=n.slice(0).sort(function(t,n){return t-n}),c=n[0],d=n[0],h=[],_=0,l=function(){for(var t=0,r=n.length,i=0;r>t;t++){var a=n[t];a>d&&(d=a),c>a&&(c=a),t>0&&h.push(u[t]-u[t-1]),t>0&&(_+=Math.abs(u[t]-u[t-1])),i+=Math.abs(a-u[t])}return _/=r,i/r}();h.sort(function(t,n){return t-n});for(var p=(h[0],function(t){for(var r=function(r,i,a){var s=[],e=n.length;for(i||(i=0);e>r;r++){var o=n[r];if(o-a!=1){var f=r+i;0>f&&(f=0),f>=e&&(f=e-1),t(o,u[f],o,a,r,e)&&(n[r+1]&&n[r+1]<o&&n[r+1]>a||(s.push(o),a=o))}else s.push(o),a=o}return s},i=[],a=0;.1>a;){for(var s=-5;5>=s;s++)i.push(r(Math.floor(n.length*a),s,c-1));a+=.05}return i.sort(function(t,n){return n.length-t.length}),i[0]}),v=[p(function(t,n,r,i,a,s){return i>r?!1:a>0&&Math.abs(r-i)>h[a-1]?!1:Math.abs(r-i)>l?!1:Math.abs(t-n)<=l*(a/s)&&r>=i?!0:Math.abs(i-r)<=l*(a/s)&&r>=i?!0:!1}),p(function(t,n,r,i,a,s){return i>r?!1:Math.abs(r-i)>l?!1:Math.abs(t-n)<=l*(a/s)&&r>=i?!0:Math.abs(i-r)<=l*(a/s)&&r>=i?!0:!1}),p(function(t,n,r,i,a,s){return i>r?!1:Math.abs(r-i)>l?!1:Math.abs(t-n)<=l*(a/s)&&r>=i?!0:Math.abs(i-r)<=l*(a/s)&&r>=i?!0:!1}),p(function(t,n,r,i,a,s){return i>r?!1:Math.abs(t-n)<=l*(a/s)&&r>=i?!0:Math.abs(i-r)<=l*(a/s)&&r>=i?!0:!1}),p(function(t,n,r,i,a,s){return i>r?!1:Math.abs(t-n)<=l&&r>=i?!0:Math.abs(i-r)<=l*(a/s)&&r>=i?!0:!1}),p(function(t,n,r,i){return i>r?!1:Math.abs(r-i)<_?!0:Math.abs(t-n)<=_&&r>=i?!0:!1}),p(function(t,n,r,i){return r>i?!0:!1}),p(function(t,n,r,i){return i>r?!1:Math.abs(r-i)>l?!1:Math.abs(t-n)<=l&&r>=i?!0:!1}),p(function(t,n,r,i,a,s){return i>r?!1:a>0&&Math.abs(r-i)>l?!1:Math.abs(t-n)<=l*(a/s)&&r>=i?!0:a>0&&Math.abs(i-r)<=l*(a/s)&&r>=i?!0:!1}),p(function(t,n,r,i){if(i>r)return!1;if(i>=c){if(r>=i)return!0}else if(r==c)return!0;return!1})],b=[],m=0,o=0;o<v.length;o++){var O=v[o];O.length>m&&(b=O,m=O.length)}0==b.length&&(b=[u[Math.floor(u.length/2)]]);{var M=[],y=[];!function(){for(var t=c,r=b[0],i=b.length,a=n.indexOf(r),s=0,e=0,o=n.length;o>e;e++){var f=n[e];f>=t&&r>=f&&a>=e?(M.push(f),t=f):y.push(f),f==r&&(t=f,i-1>s?(s++,r=b[s],a=n.indexOf(r)):(r=d,a=o+1))}}()}y.sort(function(t,n){return t-n});!function(){for(var t=0,n=0,i=M[0],a=y.length;a>t;){var s=M[n],o=y[t];if("undefined"==typeof s){for(;a>t;)r.push(["b",e[o],e[i]]),i=o,t++,o=y[t];return}o>s?(i=s,n++):(r.push(["a",e[o],e[s]]),t++)}}();return n}var r=[];return n(t),r}}(this)},r=function(t,n,i,a,s,e,o,f){var u,c=this;if(!(c instanceof r))return new r(t,n,i,a,s,e,o,f);var d=[t,n,i,a,s,e,o,f];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){u=t.apply(c,d)}),"function"==typeof u){if(u._classInfo.name!=r._classInfo.name)return new u(t,n,i,a,s,e,o,f)}else if(u)return u;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,d)}):"function"==typeof c.init&&c.init.apply(c,d)};r._classInfo={name:"moshDiff"},r.prototype=new n,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.moshDiff=r,this.moshDiff=r):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.moshDiff=r:this.moshDiff=r}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());